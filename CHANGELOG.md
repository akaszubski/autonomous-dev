## [Unreleased]

### Added
- AUTO_INSTALL_DEPS environment variable for automatic dependency installation
  - Created auto_install_deps.py library with security-first design
  - Parses pytest output for ImportError/ModuleNotFoundError
  - Extracts package names from error messages
  - Validates packages against project requirements files (pyproject.toml, requirements.txt)
  - Only installs packages explicitly listed in project requirements (CWE-494 prevention)
  - Uses subprocess with shell=False (CWE-78 prevention, no command injection)
  - 30-second timeout for pip install (default, configurable)
  - Audit logging for all install attempts
  - Environment variable: AUTO_INSTALL_DEPS=true to enable (default: false)
  - Package name mapping for PyPI vs import names (e.g., pillow -> PIL)
  - Core functions: extract_missing_packages(), is_package_allowed(), install_package(), auto_install_missing_deps()
  - Security features: Whitelist validation, audit logging, timeout protection
- Test coverage threshold now configurable via environment variables (#238)
  - Enhanced auto_enforce_coverage.py with MIN_COVERAGE env var (default: 70%)
  - Added COVERAGE_REPORT env var for custom report path
  - 8 unit tests for environment variable configuration
- Pre-commit hook to enforce logging over print statements (#236)
  - Created enforce_logging_only.py with print statement detection
  - Scans lib/ and hooks/ directories for print statements
  - Excludes CLI tools (argparse, click, typer, main guard)
  - Excludes test files by default
  - Environment variable: ENFORCE_LOGGING_ONLY=true to enable (default: false)
  - Additional controls: ALLOW_PRINT_IN_CLI, ALLOW_PRINT_IN_TESTS
  - 25+ unit tests for comprehensive coverage
- Document doc-master command deprecation/rename handling workflow (#228)
  - 5-step workflow for comprehensive deprecation handling
  - Step 1: Find ALL references (grep entire codebase)
  - Step 2: Categorize by location (docs vs historical vs hooks)
  - Step 3: Bulk update non-historical references
  - Step 4: Update validation hooks
  - Step 5: Verify zero remaining stale references
  - Prevents 80%+ of missed references during command consolidation
- Create plugins/autonomous-dev/README.md with comprehensive user documentation (#233)
  - User-focused installation and quick-start guide (5 minutes)
  - All 8 core commands with examples and use cases
  - Configuration guide (environment variables, git automation, MCP auto-approval)
  - 22-agent architecture overview with model tier strategy
  - 66-hook automation reference with examples
  - Troubleshooting guide with common issues and solutions
  - Best practices section (context management, workflow discipline, PROJECT.md-first)
  - Documentation index linking to all detailed guides
  - Cross-references to contributor and security documentation
- Unified `/implement` command with mode flags (#203)
  - Default mode: Full 8-agent pipeline (replaces `/auto-implement`)
  - `--quick`: Implementer agent only (replaces old `/implement`)
  - `--batch <file>`: Batch from file with auto-worktree isolation
  - `--issues <nums>`: Batch from GitHub issues with auto-worktree isolation
  - `--resume <id>`: Resume interrupted batch
  - Auto-worktree creation for batch modes (isolated development)
  - Created `batch_orchestrator.py` library for flag parsing and mode routing
  - 32 unit tests + 14 integration tests
- Per-worktree batch state isolation for concurrent development (#226)
  - Enhanced get_batch_state_file() to detect git worktrees
  - Worktrees now use isolated batch state: WORKTREE_DIR/.claude/batch_state.json
  - Main repository continues using: REPO_ROOT/.claude/batch_state.json (backward compatible)
  - Graceful fallback to main repo behavior on detection errors
  - Security: CWE-22 (path traversal), CWE-59 (symlink) protection maintained
  - Added is_worktree() lazy-loaded wrapper in path_utils.py
  - Performance: Worktree detection <1ms, zero overhead for state isolation
  - 15 unit tests + 9 integration tests with real git worktrees
  - Enables concurrent batch processing in multiple worktrees without interference
- StateManager Abstract Base Class for state management (#220)
  - Created abstract_state_manager.py with StateManager ABC
  - Abstract methods: load_state(), save_state(), cleanup_state()
  - Concrete helpers: exists(), _validate_state_path(), _atomic_write(), _get_file_lock(), _audit_operation()
  - Security features: CWE-22 path traversal, CWE-59 symlink, CWE-367 atomic writes, CWE-732 permissions
  - Added StateError exception to exceptions.py hierarchy
  - Phase 1 complete: ABC foundation created
  - Phase 2-6 pending: Manager inheritance migration
  - 19 tests passing, 14 skipped (pending phases)

### Changed
- Migrate SessionTracker to inherit from StateManager ABC (#224)
  - SessionTracker now inherits from StateManager[str] (str for markdown content)
  - Implements abstract methods: load_state(), save_state(), cleanup_state()
  - Uses inherited helpers: _validate_state_path(), _atomic_write(), _get_file_lock(), _audit_operation()
  - Maintains full backward compatibility with existing log() method
  - Phase 5 of StateManager migration: SessionTracker complete
- Migrate CheckpointManager to inherit from StateManager ABC (#223)
  - CheckpointManager now inherits from StateManager[Dict[str, Any]]
  - Implements abstract methods: load_state(), save_state(), cleanup_state()
  - Uses inherited helpers: _validate_state_path(), _atomic_write(), _get_file_lock(), _audit_operation()
  - CheckpointError is now an alias for StateError (backward compatible)
  - Maintains full backward compatibility with existing create_checkpoint(), load_checkpoint(), etc. methods
  - Reduces code duplication and ensures consistent state management patterns
  - Phase 4 of StateManager migration: CheckpointManager complete
- Migrate UserStateManager to inherit from StateManager ABC (#222)
  - UserStateManager now inherits from StateManager[Dict[str, Any]]
  - Implements abstract methods: load_state(), save_state(), cleanup_state()
  - Uses inherited helpers: _validate_state_path(), _atomic_write(), _get_file_lock(), _audit_operation()
  - UserStateError is now an alias for StateError (backward compatible)
  - Reduces code duplication and ensures consistent state management patterns
  - Phase 3 of StateManager migration: UserStateManager complete
- Migrate BatchStateManager to inherit from StateManager ABC (#221)
  - BatchStateManager now inherits from StateManager[BatchState]
  - Implements abstract methods: load_state(), save_state(), cleanup_state()
  - Uses inherited helpers: _validate_state_path(), _atomic_write(), _get_file_lock(), _audit_operation()
  - Full backward compatibility maintained via delegation to batch-specific methods
  - Reduces code duplication and ensures consistent state management patterns
  - Phase 2 of StateManager migration: BatchStateManager complete
- Consolidate exception hierarchy: All state managers now use StateError (#225)
  - BatchStateError is now an alias for StateError (backward compatible)
  - brownfield_retrofit.py now imports StateError from centralized exceptions.py
  - Exception hierarchy: AutonomousDevError > StateError (all state-related errors)
  - Ensures consistent exception handling across all state managers
  - Phase 6 of StateManager migration: Exception consolidation complete

### Deprecated
- `/auto-implement` command - Use `/implement` instead (full pipeline is default) (#203)
- `/batch-implement` command - Use `/implement --batch`, `--issues`, or `--resume` (#203)
- Old `/implement` behavior - Use `/implement --quick` for implementer-only mode (#203)
- Deprecation shims redirect to new command with notice, planned removal in v4.0.0

### Removed
- **BREAKING**: Remove deprecated context clearing functions (#218)
  - Removed `should_clear_context()` function
  - Removed `pause_batch_for_clear()` function
  - Removed `get_clear_notification_message()` function
  - Removed `@deprecated` decorator (no longer needed)
  - Removed `CONTEXT_THRESHOLD` constant (150K threshold no longer applicable)
  - Rationale: Claude Code handles context automatically with 200K token budget
  - Migration: Remove any calls to these functions (deprecated since v3.34.0)

### Fixed
- Fix 3 critical test failures blocking CI/CD (#229)
  - Fixed missing `import os` in genai_prompts.py preventing module import
  - Fixed unterminated f-string in test_documentation_consistency.py causing syntax error
  - Fixed incorrect path reference (scripts→hooks) in test_claude_alignment.py
  - All tests now pass in CI/CD pipeline
- Batch worktree CWD change fix
  - `create_batch_worktree()` now automatically changes current working directory to worktree after creation
  - Ensures all subsequent operations (file writes, edits, shell commands) execute within worktree context
  - Returns `original_cwd` in result dictionary for restoration if needed
  - Side effects documented in function docstring and implement.md command documentation
  - Eliminates manual CWD management in batch processing workflows
- Resolve invalid escape sequence warnings in Python 3.12+ (#216)
  - Fixed SyntaxWarning in docstring examples by double-escaping regex patterns
  - Updated files: code_path_analyzer.py, success_criteria_validator.py
  - Applied fixes to both .claude/lib and plugins/autonomous-dev/lib
  - Added 32 regression tests to prevent future reintroduction

### Changed
- Centralize GitHub API exceptions into exceptions.py (#219)
  - Created exceptions.py with AutonomousDevError base and 3-level hierarchy
  - Moved GitHubAPIError, IssueNotFoundError, IssueAlreadyClosedError to central module
  - Updated github_issue_closer.py, github_issue_fetcher.py, batch_issue_closer.py imports
  - Reduces duplicate exception definitions
- Consolidate 3 validate_path() implementations into single source of truth (#217)
  - Unified 3 duplicate implementations into security_utils.validate_path():
    - validation.validate_session_path() now delegates to security_utils
    - feature_flags.validate_path() now delegates to security_utils
    - worktree_conflict_integration.validate_path() now delegates to security_utils
  - Security improvements: 4-layer validation (string-level checks, symlink detection, path resolution, whitelist validation)
  - Reduces code duplication (~150 lines)
  - Ensures consistent path validation across codebase
  - Applied to both .claude/lib and plugins/autonomous-dev/lib
  - Added 23 regression tests for path validation consolidation
- Audit and consolidate validation hooks (#215)
  - Unified 12 documentation validators into unified_doc_validator.py dispatcher:
    - Consolidated: validate_project_alignment, validate_claude_alignment, validate_documentation_alignment, validate_docs_consistency, validate_readme_accuracy, validate_readme_sync, validate_readme_with_genai, validate_command_file_ops, validate_commands, validate_hooks_documented, validate_command_frontmatter_flags, validate_manifest_doc_alignment
    - Documented environment variable defaults: VALIDATE_PROJECT_ALIGNMENT=true, VALIDATE_CLAUDE_ALIGNMENT=true, VALIDATE_DOC_ALIGNMENT=true, etc.
  - Unified 2 manifest validators into unified_manifest_sync.py dispatcher:
    - Consolidated: validate_install_manifest, validate_settings_hooks
    - Documented environment variable defaults: VALIDATE_MANIFEST=true, VALIDATE_SETTINGS=true, AUTO_UPDATE_MANIFEST=true
  - Updated HOOK-REGISTRY.md to mark validate_project_alignment and validate_claude_alignment as deprecated (consolidated)
  - Updated global_settings_template.json with documented PreCommit hooks section referencing unified validators
  - Improved maintainability: Single dispatcher pattern for validation hooks with clear env var control

### Added
- Document evaluation decision for setup-wizard.md split (#214)
  - Created docs/evaluations/ directory with evaluation documentation
  - Issue #214: Evaluated whether to split setup-wizard.md (1,145 lines) into multiple agents
  - Decision: KEEP UNIFIED with hybrid optimizations (extract reusable libraries)
  - Documented sequential phase dependencies and user experience impact
  - Added evaluation tests to validate assumptions and decision rationale
  - Created docs/evaluations/README.md as index of evaluation documents
  - Established pattern for future architectural evaluations
- Create HOOK-REGISTRY.md with activation status (#209)
  - Comprehensive registry of all 66 hooks with activation status
  - Documents trigger points, environment variables, and purposes
  - Provides quick reference for hook lifecycle integration points
  - Added cross-references to HOOKS.md, SANDBOXING.md, GIT-AUTOMATION.md
  - Added 34 tests for hook registry validation

### Changed
- Consolidate alignment commands into single /align command (#210)
  - Removed legacy commands: `/align-project`, `/align-project-retrofit`, `/align-claude`
  - Consolidated into `/align` with three modes: `project`, `retrofit`, `claude`
  - Updated BROWNFIELD-ADOPTION.md to use `/align --retrofit`
  - Updated WORKFLOWS.md to use `/align` and `/align --retrofit`
  - Added 35 tests for command consolidation validation
- Consolidate ARCHITECTURE.md into ARCHITECTURE-OVERVIEW.md (#208)
  - Archived ARCHITECTURE.md to docs/archived/ with deprecation notice
  - Updated 10+ file references to point to ARCHITECTURE-OVERVIEW.md
  - Added 21 tests for consolidation validation
  - Ensures single source of truth for architecture documentation
- Archive disabled hooks with deprecation docs (#211)
  - Consolidated auto_approve_tool.py and mcp_security_enforcer.py into unified_pre_tool.py
  - Created plugins/autonomous-dev/hooks/archived/README.md with migration guide
  - Updated docs/HOOKS.md with consolidated hook consolidation section
  - Updated docs/SANDBOXING.md with historical note and consolidated architecture explanation
  - Updated docs/TOOL-AUTO-APPROVAL.md with deprecation notice (Layer 4 of unified_pre_tool.py)
  - Updated docs/MCP-SECURITY.md with deprecation notice (Layer 2 of unified_pre_tool.py)
  - Updated docs/HOOK-REGISTRY.md to mark archived hooks as deprecated
  - No functionality changes - all features preserved in unified_pre_tool.py
- Resolve duplicate auto_git_workflow.py (#212)
  - Archived duplicate auto_git_workflow.py hook file
  - Created backward compatibility shim at .claude/hooks/auto_git_workflow.py (56 lines)
  - Shim redirects to unified_git_automation.py for single source of truth
  - Updated docs/GIT-AUTOMATION.md with deprecation notice and migration guidance
  - Updated docs/HOOKS.md with archival context
  - Updated docs/ARCHITECTURE-OVERVIEW.md to document shim and unified implementation
  - Updated plugins/autonomous-dev/hooks/archived/README.md with auto_git_workflow.py archival details
  - All git automation functionality preserved with unified consolidation
- Standardize command YAML frontmatter (#213)
  - Created COMMAND-FRONTMATTER-SCHEMA.md with complete field definitions and examples
  - Updated all 21 command files to use kebab-case field names (argument-hint, allowed-tools)
  - Deprecated `tools:` field in favor of `allowed-tools:` (security-enforced)
  - Added validation hook: validate_command_frontmatter_flags.py
  - Added 28 tests for frontmatter standardization validation
  - Ensures consistent autocomplete metadata and security whitelisting

## [3.46.0] - 2026-01-09
### Changed
- Update component counts across all documentation (#207)
  - Commands: 9 → 24 (consolidated /implement variations, added /worktree and others)
  - Hooks: 64 → 67 (added pre-commit hook variations)
  - Libraries: 69 → 145 (expanded automation, validation, infrastructure libraries)
  - Updated CLAUDE.md Component Versions table
  - Updated docs/ARCHITECTURE-OVERVIEW.md counts
  - Updated docs/DOCUMENTATION_INDEX.md counts
- Simplify version tracking: Single source of truth via VERSION file (#206)
  - CLAUDE.md now references `plugins/autonomous-dev/VERSION` instead of hardcoded version
  - Removed Version column from Component Versions table
  - Removed version annotations from pipeline step descriptions
  - Added `_read_version_file()` and `_check_no_hardcoded_versions()` validation methods

### Fixed
- Fix doc-master auto-apply (#204)