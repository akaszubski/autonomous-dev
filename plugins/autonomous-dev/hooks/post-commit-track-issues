#!/bin/bash
# post-commit hook: Auto-track issues after commit
#
# Optional: Run after each commit (can be noisy)
# Better to use pre-push instead
#
# Configuration (.env):
# GITHUB_TRACK_ON_COMMIT=true  # Enable

# Load .env if exists
if [ -f .env ]; then
    set -a
    source .env
    set +a
fi

# Check if enabled (default: false)
if [ "${GITHUB_AUTO_TRACK_ISSUES:-false}" != "true" ]; then
    exit 0
fi

if [ "${GITHUB_TRACK_ON_COMMIT:-false}" != "true" ]; then
    exit 0
fi

echo "üîç Checking for issues to track..."

# Find hook script
HOOK_SCRIPT="plugins/autonomous-dev/hooks/auto_track_issues.py"

if [ ! -f "$HOOK_SCRIPT" ]; then
    if [ -f ".claude/hooks/auto_track_issues.py" ]; then
        HOOK_SCRIPT=".claude/hooks/auto_track_issues.py"
    else
        exit 0
    fi
fi

# Run in background (non-blocking)
python3 "$HOOK_SCRIPT" &

exit 0
